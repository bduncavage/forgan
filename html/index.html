<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>
Title
</title>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="../static/noteTable.js"></script>
<script type="text/javascript" src="../static/note.js"></script>
<script type="text/javascript" src="../static/measure.js"></script>
<script type="text/javascript" src="../static/song.js"></script>

<script type="text/javascript">

// stupid this should be wrapped in a library
// ... but this is a hack.
var echonestSearchEndpoint = 'http://developer.echonest.com/api/v4/song/search?api_key=N6E4NIOVYMTHNDM8J&artist=[artist]&title=[songTitle]';
var echonestProfileEndpoint = 'http://developer.echonest.com/api/v4/song/profile?api_key=N6E4NIOVYMTHNDM8J&id=[songId]&bucket=audio_summary';

var audioContext = new webkitAudioContext();
var currentSongProfile = null;
var currentSongAnalysis = null;
var sampleSongId = 'SORSQAD1311AFDFFF1';

function playSampleSong() {
  new Song(audioContext, 10, 80).playOn(0);
}

function getAnalysis(artist, songTitle) {
  /* Just return the local sample data while
   * crabclaw gets the flask api up and running
  artist = escape(artist);
  songTitle = escape(songTitle);
  var searchUrl = echonestSearchEndpoint.replace('[artist]', artist).replace('[songTitle]', songTitle);
  $.get(searchUrl, function(data) {
    // just pick the first result
    var songId = data.response.songs[0].id;
    // now get the profile data
    var profileUrl = echonestProfileEndpoint.replace('[songId]', songId);
    $.get(profileUrl, function(data) {
      // finally get the analysis data
      var analysisUrl = data.response.songs[0].audio_summary.analysis_url;
      currentSongProfile = data.response.songs[0].audio_summary;
      $.get(analysisUrl, function(data) {
        currentSongAnalysis = data;
      });
    });
  });
  */
  $.get('js/sampleData/blitzkreig_bop.json', function (data) {
    currentSongAnalysis = data;
    var profileUrl = echonestProfileEndpoint.replace('[songId]', sampleSongId;
    $.get(profileUrl, function(data) {
      currentSongProfile = data.response.songs[0].audio_summary;
      startGenesisDevice();
    } 
  }
} 

function startGenesisDevice() {
  
}

</script>

</head>

<body>

<div>
<button type="button" onclick="playSampleSong();">Play Random</button>
</div>

<div>
<input type=text" name="artistName" value="ramones" /><input type="text" value="blitzkreig bop" name="songTitle" />
<button type="button" onclick="getAnalysis(document.getElementsByName('artistName')[0].value, document.getElementsByName('songTitle')[0].value);">Begin!</button>
</div>

</body>

</html>
