<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>
Title
</title>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="../static/noteTable.js"></script>
<script type="text/javascript" src="../static/note.js"></script>
<script type="text/javascript" src="../static/measure.js"></script>
<script type="text/javascript" src="../static/song.js"></script>
<script type="text/javascript" src="../static/genesisDevice.js"></script>

<script type="text/javascript">

// stupid this should be wrapped in a library
// ... but this is a hack.
var apiEndpoint = 'http://evolv3r.herokuapp.com/api/getEchonestData?artist=[artist]&track=[songTitle]';
var echonestProfileEndpoint = 'http://developer.echonest.com/api/v4/song/profile?api_key=N6E4NIOVYMTHNDM8J&id=[songId]&bucket=audio_summary';
var audioContext = new webkitAudioContext();
var genesisDevice = new GenesisDevice(audioContext);
var song = null;

var currentSongProfile = null;
var currentSongAnalysis = null;
var sampleSongId = 'SORSQAD1311AFDFFF1';

function playSampleSong() {
  new Song(audioContext, 10, 80).playOn(0);
}

function getAnalysis(artist, songTitle) {
  var artist = escape(artist);
  var songTitle = escape(songTitle);

  var url = apiEndpoint.replace('[artist]', artist).replace('[songTitle]', songTitle);
  $.get(url, function(data) {
    currentSongAnalysis = data.profile;
    currentSongProfile = data.summary;
    startGenesisDevice(currentSongAnalysis); 
  });
 /* 
  $.get('../static/sampleData/blitzkreig_bop.json', function (data) {
    currentSongAnalysis = data;
    var profileUrl = echonestProfileEndpoint.replace('[songId]', sampleSongId);
    $.get(profileUrl, function(data) {
      currentSongProfile = data.response.songs[0].audio_summary;
      startGenesisDevice(currentSongAnalysis);
    });
  });
  */
} 

function startGenesisDevice(analysisData) {
  var notes = genesisDevice.ignite(analysisData);
  song = new Song(audioContext, analysisData.track.duration, analysisData.track.tempo, notes);

  song.playOn(0);
}

</script>

</head>

<body>

<div>
<button type="button" onclick="playSampleSong();">Play Random</button>
</div>

<div>
<input type=text" name="artistName" value="ramones" /><input type="text" value="blitzkreig bop" name="songTitle" />
<button type="button" onclick="getAnalysis(document.getElementsByName('artistName')[0].value, document.getElementsByName('songTitle')[0].value);">Begin!</button>
<button type="button" onclick="song.playOff(0);">Stop</button>
</div>

</body>

</html>
